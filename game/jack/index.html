<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.21.0/dist/phaser.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: 1080,
        height: 1920,
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);

    var selected = null;
    var cards = [];
    var moving = null;
    var down = null;

    function preload ()
    {
        this.load.setBaseURL('http://www.tzjlovekxj.com/game/jack');

        this.load.image('road3', 'img/road3.png');
        this.load.image('road4', 'img/road4.png');
        this.load.image('f1', 'img/f1.png');
        this.load.image('f2', 'img/f2.png');
        this.load.image('f3', 'img/f3.png');
        this.load.image('f4', 'img/f4.png');
        this.load.image('f5', 'img/f5.png');
        this.load.image('f6', 'img/f6.png');
        this.load.image('f7', 'img/f7.png');
        this.load.image('f8', 'img/f8.png');
        this.load.image('f9', 'img/f9.png');
    }

    function create ()
    {
        var cross = parseInt(Math.random() * 9);
        var pos = [150, 450, 750];
        var faces = ['f1', 'f2', 'f3', 'f4', 'f5', 'f6', 'f7', 'f8'];
        for (var i = 0; i < 3; i++) {
            var x = i * 300 + 150;
            for (var j = 0; j < 3; j++) {
                var y = j * 300 + 150;
                var road, face;
                if (3 * i + j == cross) {
                    road = 'road4';
                    face = 'f9';
                }
                else {
                    road = 'road3';
                    index = parseInt(Math.random() * faces.length);
                    face = faces[index];
                    faces.splice(index, 1);
                }
                var bg = this.add.image(0, 0, road);
                bg.setDisplaySize(200, 200).refreshBody();
                var fc = this.add.image(0, 0, face);
                fc.setDisplaySize(200, 200).refreshBody();
                var container = this.add.container(x, y, [bg, fc]);
                console.log(container.x, container.y);
                if (i == 0 && j == 0) {
                    container.rotation = Math.PI / 2;
                }
                else if (i == 2 && j == 0) {
                    container.rotation = Math.PI / 2 * 3;
                }
                else if (i == 1 && j == 2) {
                    container.rotation = 0;
                }
                else {
                    container.rotation = parseInt(Math.random() * 4) * Math.PI / 2;
                }
                container.setSize(bg.width, bg.height);
                var hitArea = new Phaser.Geom.Rectangle(0,0,300,300);
                container.setInteractive(hitArea, Phaser.Geom.Rectangle.Contains);
                this.input.setDraggable(container);
                container.on('dragstart', function () {
                    console.log("dragstart");
                    var i = (this.x - 150) / 300;
                    var j = (this.y - 150) / 300;
                    moving = [i, j];
                    if (game.getTime() - down < 200) {
                        this.list[1].setVisible(!this.list[1].visible);
                    }
                    else {
                        down = game.getTime();
                    }
                });
                container.on('drag', function (pointer) {
                    console.log("drag");
                    this.x = pointer.x;
                    this.y = pointer.y;
                });
                container.on('dragend', function (pointer, dragX, dragY) {
                    console.log("dragend");
                    this.x = Math.round((this.x - 150) / 300) * 300 + 150;
                    this.y = Math.round((this.y - 150) / 300) * 300 + 150;
                    var i = (this.x - 150) / 300;
                    var j = (this.y - 150) / 300;
                    if (cards[3 * i + j] != this) {
                        cards[3 * moving[0] + moving[1]] = cards[3 * i + j];
                        cards[3 * i + j] = this;
                        cards[3 * moving[0] + moving[1]].x = moving[0] * 300 + 150;
                        cards[3 * moving[0] + moving[1]].y = moving[1] * 300 + 150;
                    }
                    else {
                        if (game.getTime() - down > 500) {
                            this.rotation += Math.PI / 2;
                            down = null;
                        }
                    }
                });

                cards.push(container);
            }
        }
    }

    function update ()
    {
    }
    </script>

</body>
</html>